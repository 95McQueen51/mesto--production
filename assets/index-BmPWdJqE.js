(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(c){if(c.ep)return;c.ep=!0;const r=n(c);fetch(c.href,r)}})();const z=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),N=(e,{onPreviewPicture:t,onLikeIcon:n,onDeleteCard:o},c)=>{const r=z(),a=r.querySelector(".card__like-button"),y=r.querySelector(".card__control-button_type_delete"),h=r.querySelector(".card__image"),d=r.querySelector(".card__like-count");return h.src=e.link,h.alt=e.name,r.querySelector(".card__title").textContent=e.name,d&&(d.textContent=e.likes?e.likes.length:0),e.likes&&e.likes.some(s=>s._id===c)&&a.classList.add("card__like-button_is-active"),e.owner&&e.owner._id!==c&&(y.style.display="none"),n&&a.addEventListener("click",()=>{const s=a.classList.contains("card__like-button_is-active");n(a,e._id,s,f=>{d&&(d.textContent=f)})}),o&&y.addEventListener("click",()=>o(e._id,r)),t&&h.addEventListener("click",()=>t({name:e.name,link:e.link})),r},F=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");_(t)}},g=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",F)},_=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",F)},K=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{_(e)}),e.addEventListener("mousedown",n=>{n.target.classList.contains("popup")&&_(e)})},w=(e,t,n,o)=>{const c=e.querySelector(`#${t.id}-error`);t.classList.toggle(o.inputErrorClass,!0),c.textContent=n,c.classList.add(o.errorClass)},G=(e,t,n)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.toggle(n.inputErrorClass,!1),o.textContent="",o.classList.remove(n.errorClass)},Q=(e,t,n)=>(t.validity.patternMismatch&&t.dataset.errorMessage?w(e,t,t.dataset.errorMessage,n):t.validity.valid?G(e,t,n):w(e,t,t.validationMessage,n),t.validity.valid),X=e=>e.some(t=>!t.validity.valid),Y=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},Z=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},D=(e,t,n)=>{X(e)?Y(t,n):Z(t,n)};function ee(e,t){let n=e.querySelectorAll(t.inputSelector),o=e.querySelector(t.submitButtonSelector),c=[];for(let r=0;r<n.length;r++)c[r]=n[r];D(c,o,t);for(let r=0;r<c.length;r++)c[r].addEventListener("input",function(){Q(e,c[r],t),D(c,o,t)})}const te=function(e){document.querySelectorAll(e.formSelector).forEach(function(n){n.addEventListener("submit",function(o){o.preventDefault?o.preventDefault():o.returnValue=!1}),n.querySelectorAll&&n.querySelectorAll(e.inputSelector).length>0&&ee(n,e)})},l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"ba2c09c9-85de-4b1e-9764-b3d657135af9","Content-Type":"application/json"}},m=e=>e.ok?e.json():Promise.reject("Ошибка: "+e.status),ne=()=>fetch(l.baseUrl+"/users/me",{headers:l.headers}).then(m),O=()=>fetch(l.baseUrl+"/cards",{headers:l.headers}).then(m),oe=e=>fetch(l.baseUrl+"/users/me",{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e.name,about:e.about})}).then(m),re=e=>fetch(l.baseUrl+"/users/me/avatar",{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(m),ce=e=>fetch(l.baseUrl+"/cards",{method:"POST",headers:l.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(m),le=e=>fetch(l.baseUrl+"/cards/"+e,{method:"DELETE",headers:l.headers}).then(m),se=(e,t)=>{let n;return t?n="DELETE":n="PUT",fetch(l.baseUrl+"/cards/likes/"+e,{method:n,headers:l.headers}).then(m)},ie={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};te(ie);const H=document.querySelector(".places__list"),C=document.querySelector(".popup_type_edit"),L=C.querySelector(".popup__form"),j=L.querySelector(".popup__input_type_name"),W=L.querySelector(".popup__input_type_description"),q=document.querySelector(".popup_type_new-card"),S=q.querySelector(".popup__form"),ae=S.querySelector(".popup__input_type_card-name"),ue=S.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),U=E.querySelector(".popup__image"),de=E.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),fe=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),M=B.querySelector(".popup__form"),me=M.querySelector(".popup__input"),_e=document.querySelector(".logo"),T=document.querySelector(".popup_type_info"),i=T.querySelector(".popup-info__list_type_definitions"),v=T.querySelector(".popup-info__list_type_users");let b;const A=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),p=(e,t)=>{const o=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return o.querySelector(".popup-info__text_type_term").textContent=e,o.querySelector(".popup-info__text_type_definition").textContent=t,o},ye=(e,t)=>{const o=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0),c=o.querySelector(".popup-info__user-name"),r=o.querySelector(".popup-info__user-cards-count");return c.textContent=e.name,r.textContent=` [${t}]`,o},he=function(){i.innerHTML="",v.innerHTML="",i.append(p("Статус:","Загрузка данных...")),g(T),O().then(function(e){if(i.innerHTML="",!e||e.length===0){i.append(p("Информация:","Карточки не найдены"));return}let t=e.length;i.append(p("Всего карточек:",t+""));let n=e.slice();n.sort(function(u,s){let f=new Date(u.createdAt),R=new Date(s.createdAt);return f-R});let o=A(new Date(n[0].createdAt)),c=A(new Date(n[n.length-1].createdAt));i.append(p("Первая создана:",o)),i.append(p("Последняя создана:",c));let r={};for(let u=0;u<e.length;u++){let s=e[u],f=s.owner._id;r[f]||(r[f]={user:s.owner,cardCount:0}),r[f].cardCount++}let a=Object.keys(r);i.append(p("Всего пользователей:",a.length+""));let y=[];for(let u in r)y.push(r[u].cardCount);let h=Math.max(...y);i.append(p("Максимум карточек от одного:",h+""));let d=document.createElement("h4");d.textContent="Все пользователи:",d.className="popup-info__users-title",v.parentNode.insertBefore(d,v);for(let u in r){let s=r[u];v.append(ye(s.user,s.cardCount))}}).catch(function(e){console.log(e),i.innerHTML="",i.append(p("Ошибка:","Не удалось загрузить статистику"))})},J=function(e){U.src=e.link,U.alt=e.name,de.textContent=e.name,g(E)},V=function(e,t,n,o){se(t,n).then(function(c){e.classList.toggle("card__like-button_is-active"),o&&o(c.likes.length)}).catch(function(c){console.log(c)})},$=function(e,t){let n=t.querySelector(".card__control-button_type_delete");if(!n)return;let o=n.innerHTML,c=n.disabled;n.innerHTML="Удаление...",n.disabled=!0,le(e).then(function(){t.remove()}).catch(function(r){console.log(r),n.innerHTML=o,n.disabled=c})},ge=function(e){e.preventDefault();let t=e.target.querySelector(".popup__button"),n=t.textContent;t.textContent="Сохранение...",oe({name:j.value,about:W.value}).then(function(o){k.textContent=o.name,x.textContent=o.about,_(C)}).catch(function(o){console.log(o)}).finally(function(){t.textContent=n})},Se=function(e){e.preventDefault();let t=e.target.querySelector(".popup__button"),n=t.textContent;t.textContent="Сохранение...",re(me.value).then(function(o){I.style.backgroundImage="url("+o.avatar+")",_(B)}).catch(function(o){console.log(o)}).finally(function(){t.textContent=n})},ve=function(e){e.preventDefault();let t=e.target.querySelector(".popup__button"),n=t.textContent;t.textContent="Создание...",ce({name:ae.value,link:ue.value}).then(function(o){H.prepend(N(o,{onPreviewPicture:J,onLikeIcon:V,onDeleteCard:$},b)),_(q),S.reset()}).catch(function(o){console.log(o)}).finally(function(){t.textContent=n})};L.addEventListener("submit",ge);S.addEventListener("submit",ve);M.addEventListener("submit",Se);pe.addEventListener("click",function(){j.value=k.textContent,W.value=x.textContent,g(C)});I.addEventListener("click",function(){M.reset(),g(B)});fe.addEventListener("click",function(){S.reset(),g(q)});_e.addEventListener("click",he);let P=document.querySelectorAll(".popup");for(let e=0;e<P.length;e++)K(P[e]);Promise.all([O(),ne()]).then(function(e){let t=e[0],n=e[1];b=n._id,k.textContent=n.name,x.textContent=n.about,I.style.backgroundImage="url("+n.avatar+")";for(let o=0;o<t.length;o++)H.append(N(t[o],{onPreviewPicture:J,onLikeIcon:V,onDeleteCard:$},b))}).catch(function(e){console.log(e)});
